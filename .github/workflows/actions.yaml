name: actions
on:
  #push: {}
  #pull_request: {}
  workflow_dispatch: {}

permissions:
  contents: read
  packages: write

jobs:
  build-new:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        ghc:
          - "native 9.12.2"
          #- "native 9.10.1"
          #- "native 9.8.4"
          #- "native-bad 9.6.7"
          #- "native-bad 9.4.8"
          #- "wasm wasm32-wasi-9.12.2.20250327"
          #- "wasm wasm32-wasi-9.10.1.20250327"
          #- "wasm wasm32-wasi-9.8.4.20250206"
          #- "js javascript-unknown-ghcjs-9.12.1"
          #- "js javascript-unknown-ghcjs-9.10.0.20240413"
          #- "mhs"
    steps:

      - name: Checkout (GitHub)
        uses: actions/checkout@v3

      - name: Login to GitHub Container Registry
        uses: docker/login-action@v2
        with:
          registry: ghcr.io
          username: ${{github.repository_owner}}
          password: ${{secrets.GITHUB_TOKEN}}

      - name: Build and run dev container task
        uses: devcontainers/ci@v0.3
        with:
          #imageName: ghcr.io/haskell/time-build
          cacheFrom: ghcr.io/haskell/time-build
          #push: always
          #refFilterForPush: refs/head/master
          runCmd: "build-${{matrix.ghc}}"
