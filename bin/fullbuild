#!/bin/bash -e
git clean -dXf
cabal update

for V in $GHC_PLAIN_VERSIONS
do
ghcup set ghc $V
build-plain
done

for V in $GHC_PLAIN_BAD_VERSIONS
do
ghcup set ghc $V
if cabal v1-configure --enable-tests;
then
    echo "time incorrectly selected with unsupported GHC version $V"
    exit 1
else
    echo "time correctly deselected with unsupported GHC version $V"
fi
done

for V in $GHC_WASM_VERSIONS
do
ghcup set ghc $V
build-wasm
done

for V in $GHC_JS_VERSIONS
do
ghcup set ghc $V
build-js
done
